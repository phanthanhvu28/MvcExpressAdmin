
@{
    ViewBag.Title = "Phân quyền";
    Layout = "~/Views/Shared/_Layout.cshtml";
    MvcExpressAdmin.Controllers.AdminSiteController myclass = new MvcExpressAdmin.Controllers.AdminSiteController();
}
@section scripts{
    <script>
                //$(document).ready(function () {
                //    $("#tableGrid").DataTable({
                //        "processing": true, // for show progress bar
                //        "serverSide": true, // for process server side
                //        "filter": true, // this is for disable filter (search box)
                //        "orderMulti": false, // for disable multiple column at once
                //        "pageLength": 10,

                //        "ajax": {
                //            "url": "/rssNews/LoadData",
                //            "type": "POST",
                //            "datatype": "json"
                //        },
                //        "columnDefs":// khong filter cột
                //            [{
                //                "targets": [0],//Customer ID
                //                "visible": true,
                //                "searchable": true
                //            }
                //                ,

                //            {
                //                "targets": [2], //Phone
                //                "searchable": false,
                //                "orderable": false
                //            },
                //            {
                //                "targets": [3],//Edit
                //                "searchable": false,
                //                "orderable": false
                //            }
                //                //{
                //                //    "targets": [9],//Delete
                //                //    "searchable": false,
                //                //    "orderable": false
                //                //}
                //            ],

                //        "columns": [
                //            { "data": "Title", "name": "Title", "autoWidth": true },
                //            { "data": "Link", "name": "Link", "title": "Link", "autoWidth": true },
                //            //{ "data": "ContactName", "name": "ContactName", "title": "Liên hệ", "autoWidth": true },
                //            //{ "data": "ContactTitle", "name": "ContactTitle", "autoWidth": true },
                //            //{ "data": "City", "name": "City", "autoWidth": true },
                //            //{ "data": "PostalCode", "name": "PostalCode", "autoWidth": true },
                //            //{ "data": "Country", "name": "Country", "autoWidth": true },
                //            //{ "data": "Phone", "name": "Phone", "title": "Điện thoại", "autoWidth": true },
                //            {
                //                "render": function (data, type, full, meta) {
                //                    return '<a class="btn btn-info" href="/rssNews/Edit/' + full.rssID + '">Edit</a>';
                //                }
                //            },
                //            {
                //                data: null, render: function (data, type, row) {
                //                    return "<a href='#' class='btn btn-danger' onclick=DeleteData('" + row.rssID + "'); >Delete</a>";
                //                }
                //            },
                //        ]
                //    });
                //});

        angular.module('phanquyen', []).controller('WebsiteInfomation', function ($scope) {
            $scope.data = {
                fullname: 'Nguyễn Văn Cường',
                email: 'Thehalfheart@gmail.com',
                phone: '0979 306 603',
                topic: 'Học lập trình online miễn phí',
                website: "freetuts.net"
            };
        });
        function BasicController($scope) {
            $scope.name = "Minh Hang",
                $scope.age = "24",
                $scope.output = function () {
                    return $scope.name + " " + $scope.age + " tuoi";
                }
        }

        function Xem_Quyen_By_MaNV(stt, manv) {
            UnAllBox();
            $('#chknv' + stt).prop("checked", true);
            $("#ndchon").val("0," + manv);
            UnCheckUserBox();
            $.ajax({
                type: "POST",                
                url: '@Url.Action("ShowPerm", "PhanQuyen")',
                data: "{'sMaNV':'" + manv + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    //alert(data.data);
                    var tv = data.data;               
                    if (tv.length > 1) {                      
                        var ch = tv.split("#$%");
                        var len = ch.length;
                        $("#lbHoTen").html(ch[0]);
                       
                        if (len > 0) {
                            for (i = 1; i < len; i++) {
                                if (ch[i] != "undifined") {
                                    $('#' + ch[i]).prop('checked', true);                                  
                                }                               
                            }
                        }
                    }                   
                },
                error: function () {

                }
            });
        }
        function UnAllBox() {            
            for (var i = 0; i < $("#dsnv").find("tr").length; i++) {
                var checkbox = $("#dsnv").find("tr").eq(i).find("td").find("input[type=checkbox]");
                $(checkbox).prop("checked", false);
                $("#ndchon").val('');
            }
        }
        function UnCheckUserBox() {
            for (var i = 1; i < $("#dscn").find("tr").length; i++) {
                var checkbox = $("#dscn").find("tr").eq(i).find("td").find("input[type=checkbox]");
                $(checkbox).attr("checked", false);
            }
        }
        function SetFunc(MaDM, MaCN) {
           
            var nd = $("#ndchon").val();
            
            var id = "lb" + MaDM.toString() + MaCN.toString();
            var chk = $("#chk" + MaDM.toString() + "-" + MaCN.toString()).is(":checked");
            
            if (nd == null || nd.length == 0 || nd == "0") {

                CheckNotify(id, "kaka", "top", "error", false, false);
                if (chk) {
                    $("#chk" + MaDM.toString() + "-" + MaCN.toString()).prop("checked", false);
                }
                else {
                    $("#chk" + MaDM.toString() + "-" + MaCN.toString()).prop("checked", true);
                }
            }
            else {                
                $.ajax({
                    type: "POST",                 
                    url: '@Url.Action("SetFunc", "PhanQuyen")',
                    data: "{'sMaDM':'" + MaDM + "', 'sMaCN':'" + MaCN + "', 'sMaNV':'" + nd + "', 'sCHK':'" + chk + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data == 1) {
                            CheckNotify("" + id, "Thành công", "top", "success", true, false);
                        }
                        else {
                            CheckNotify("" + id, "Thất bại", "top", "error", true, false);
                        }
                    },
                    error: function () {
                    }
                });
            }
        }
        function SelectUser(tt2, vl) {
            //chknv2, 56
            var tt = $("#" + tt2).is(':checked');
            var m = $("#ndchon").val();
            if (!tt) {
                m = m.replace("," + vl, "");
                $("#ndchon").val(m);
            }
            else if (tt) {
                m = m.replace("," + vl, "");
                m = m + "," + vl;
                $("#ndchon").val(m);               
            }
            else if (m != vl) {
                m = m.replace("," + vl, "");
                m = m + "," + vl;
                $("#ndchon").val(m);
            }
            else if (m == null || m.length == 0 || m == "0") {
                $("#ndchon").val("0," + vl);
            }           
        }
    </script>
}
<div class="headingtop">
    <section class="content-header">
        <asp:Panel runat="server" ID="pnplus">
            <div style="float: left; clear: both;">
                <label class="icon120m bg-blue1" onclick="ModalNVAll()" style="">
                    <i class="fa_excel fa-plus bg-blue2"></i>
                </label>
                <label class="icon120blue bg-blue2 cursor" id="Label1" onclick="ModalNVAll()">
                    @myclass.GetTT("tt_updLogin")
                    
                </label>
            </div>
        </asp:Panel>
        <asp:Panel runat="server" ID="pncopy">
            <div>
                <label class="icon120m bg-blue1" style="" onclick="CopyQuyen()">
                    <i class="fa_excel fa-exchange bg-yellow1"></i>
                </label>
                <label class="icon120blue bg-yellow1 cursor" id="Label2" onclick="CopyQuyen()">
                    @myclass.GetTT("tt_copyper")
                </label>
            </div>
        </asp:Panel>
        <asp:Panel runat="server" ID="pndel">
            <div>
                <label class="icon120m bg-red" style="" onclick="ShowDelQuyen()">
                    <i class="fa_excel fa-remove bg-purple"></i>
                </label>
                <label class="icon120blue bg-purple cursor" id="Label3" onclick="ShowDelQuyen()">
                    @myclass.GetTT("tt_delQ")
                </label>
            </div>
        </asp:Panel>

        <asp:Panel runat="server" ID="pnMDir">
            <div style="float: left;">
                <label class="icon120m bg-blue1" onclick="ModalMDir()" style="">
                    <i class="fa_excel fa-folder-open bg-blue2"></i>
                </label>
                <label class="icon120blue bg-blue2 cursor" id="Label4" onclick="ModalMDir()">
                    Quản lý thư mục
                </label>
            </div>
        </asp:Panel>

        <asp:Panel runat="server" ID="pnreset">
            <div style="float: left;">
                <label class="icon120m bg-green1" onclick="ModalResetPass()">
                    <i class="fa_excel fa-unlock-alt bg-red1"></i>
                </label>
                <label class="icon120r bg-red1 cursor" id="lbReset" onclick="ModalResetPass()">
                    @myclass.GetTT("tt_resetpw")
                </label>
            </div>
        </asp:Panel>
        <ol class="breadcrumb">
            @Html.Raw(ViewData["HeadingTopRight"])
        </ol>
    </section>
</div>
<section class="content">
    <div style="width:100%; margin-top:2px;margin-left:2px;margin-right:2px;">
        <div class="row">
            <input type="hidden" id="ndchon" />
            <div class="col-md-6">
                <div class="box box-warning">
                    <div class="box-body" id="divLeft">
                        @Html.Action("LoadNhanVien", "PhanQuyen")
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="box box-danger">
                    <div class="box-body" id="divRight">
                        @Html.Action("LoadChucNang", "PhanQuyen")

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

